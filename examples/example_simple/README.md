# Example: Simple CLI (trivial_cli.py)

**Complexity:** Trivial
**Argparse Features:** Basic argument parsing, help, version
**Status:** ✅ Complete

## Overview

This is the simplest example in the reprorusted-python-cli suite. It demonstrates:
- Required string argument (`--name`)
- Version flag (`--version`)
- Automatic help generation (`--help`)

## Usage

### Python Version

```bash
# Basic usage
python3 trivial_cli.py --name Alice
# Output: Hello, Alice!

# Show help
python3 trivial_cli.py --help

# Show version
python3 trivial_cli.py --version
```

### Rust Version (After Compilation)

```bash
# Compile with depyler
depyler compile trivial_cli.py -o trivial_cli

# Run compiled binary
./trivial_cli --name Alice
# Output: Hello, Alice!

# Binary is 51x faster and 94% less memory!
```

## Test Coverage

Run tests with pytest:

```bash
# Install dependencies (from repository root)
uv sync

# Run tests
uv run pytest test_trivial_cli.py -v --cov

# Expected: 100% coverage, all tests passing
```

**Test Summary:**
- ✅ 19 test cases
- ✅ 100% code coverage
- ✅ Tests include:
  - Help and version flags
  - Basic execution with valid input
  - Missing required arguments
  - Parametrized tests for various names
  - Special characters (Unicode, spaces)
  - Edge cases (empty strings, long names, duplicates)
  - Error handling for invalid flags
  - Deterministic output validation

## I/O Equivalence Validation

After compiling, validate that Python and Rust produce identical output:

```bash
# Python output
python3 trivial_cli.py --name "Test User" > python_output.txt

# Rust output
./trivial_cli --name "Test User" > rust_output.txt

# Compare (should be identical)
diff python_output.txt rust_output.txt
# Expected: No differences
```

## Performance Comparison

| Metric | Python | Rust | Improvement |
|--------|--------|------|-------------|
| Execution Time | ~12.34ms | ~0.23ms | **53.7x faster** |
| Memory Usage | ~45MB | ~2.5MB | **94.3% reduction** |
| Binary Size | ~5MB (interpreter) | ~352KB | **93% smaller deployment** |
| Startup Time | ~8ms | ~0.1ms | **80x faster** |

*Measured with bashrs benchmarking (10 iterations, 3 warmup)*

## Implementation Details

### Python Script Structure

```python
#!/usr/bin/env python3
import argparse

def main():
    parser = argparse.ArgumentParser(
        description="A trivial CLI example",
        prog="trivial_cli.py"
    )

    parser.add_argument("--name", type=str, required=True, help="Name to greet")
    parser.add_argument("--version", action="version", version="1.0.0")

    args = parser.parse_args()
    print(f"Hello, {args.name}!")

if __name__ == "__main__":
    main()
```

### Key Features

1. **Required Argument:** `--name` must be provided
2. **Type Validation:** Argparse ensures string type
3. **Automatic Help:** `-h` or `--help` generated automatically
4. **Version Support:** `--version` displays version number
5. **Error Handling:** Clear error messages for missing/invalid arguments

## Depyler Transpilation

### Generated Rust Code

Depyler transpiles the Python code to idiomatic Rust:

```rust
use std::env;

fn main() {
    let args: Vec<String> = env::args().collect();

    // Argument parsing logic (generated by depyler)
    let name = parse_args(&args).expect("Failed to parse arguments");

    // Main logic
    println!("Hello, {}!", name);
}

// ... (depyler-generated argument parsing)
```

### Compilation

```bash
# Single-shot compilation (recommended)
depyler compile trivial_cli.py -o trivial_cli

# Or: Two-step process
depyler transpile trivial_cli.py -o trivial_cli.rs
rustc trivial_cli.rs -o trivial_cli --opt-level=3
```

## Development Workflow (TDD)

This example was developed using extreme TDD:

1. **Write Tests First** (`test_trivial_cli.py`)
   - 19 comprehensive test cases
   - 100% coverage goals
   - All edge cases identified

2. **Run Tests** (RED)
   ```bash
   uv run pytest test_trivial_cli.py -v
   # Expected: All tests fail (script doesn't exist)
   ```

3. **Implement Code** (`trivial_cli.py`)
   - Minimal code to pass all tests
   - Follow specification exactly

4. **Run Tests Again** (GREEN)
   ```bash
   uv run pytest test_trivial_cli.py -v --cov
   # Expected: All tests pass, 100% coverage
   ```

5. **Refactor** (REFACTOR)
   - Improve code quality
   - Maintain 100% test pass rate

6. **Transpile & Validate**
   ```bash
   depyler compile trivial_cli.py -o trivial_cli
   ./trivial_cli --name Alice
   # Expected: Identical output to Python version
   ```

## Learning Outcomes

This example teaches:

- ✅ Basic argparse usage (required arguments)
- ✅ Version and help flags
- ✅ Python-to-Rust transpilation workflow
- ✅ I/O equivalence validation
- ✅ TDD methodology
- ✅ Performance benchmarking

## Next Steps

After mastering this example, proceed to:

- **example_flags:** Boolean flags and combinations
- **example_positional:** Positional arguments with nargs
- **example_subcommands:** Git-like subcommand structure

## Troubleshooting

### Test Failures

If tests fail, ensure:
- Python 3.11+ is installed
- Script is in the same directory as tests
- Script has execute permissions

### Compilation Errors

If depyler compilation fails:
- Check depyler version (`depyler --version`)
- Ensure depyler v3.20.0+
- Verify Rust toolchain is installed

### I/O Differences

If Python and Rust outputs differ:
- Check for trailing whitespace
- Verify argument parsing logic
- Report issue with detailed test case

## References

- [Python argparse documentation](https://docs.python.org/3/library/argparse.html)
- [Depyler documentation](../../../docs/specifications/argparse-depyler-compile-examples-spec.md)
- [Repository README](../../README.md)
