# Renacer Performance Assertions for reprorusted-python-cli
#
# These assertions enforce performance budgets for transpiled CLI applications.
# Assertions run at build time (via cargo test) and fail CI if violated.
#
# Toyota Way Principle: Andon (stop the line when defects detected)

[[assertion]]
name = "cli_startup_latency"
type = "critical_path"
max_duration_ms = 15  # CLI must start and complete in <15ms
fail_on_violation = true
enabled = true

[[assertion]]
name = "max_syscall_budget"
type = "span_count"
max_spans = 150  # Limit syscall overhead (prevent excessive I/O)
fail_on_violation = true
enabled = true

[[assertion]]
name = "memory_allocation_budget"
type = "memory_usage"
max_bytes = 10485760  # 10MB maximum memory allocations
tracking_mode = "allocations"
fail_on_violation = true
enabled = true

[[assertion]]
name = "prevent_god_process"
type = "anti_pattern"
pattern = "GodProcess"
threshold = 0.8  # 80% confidence threshold
fail_on_violation = false  # Warning only (not blocking)
enabled = true

[[assertion]]
name = "detect_tight_loops"
type = "anti_pattern"
pattern = "TightLoop"
threshold = 0.7
fail_on_violation = false  # Warning only
enabled = true

# Disabled assertion (example - can be enabled for stricter checking)
[[assertion]]
name = "ultra_strict_latency"
type = "critical_path"
max_duration_ms = 5  # <5ms startup (very aggressive)
fail_on_violation = true
enabled = false  # Disabled by default

# ==============================================================================
# Golden Trace Semantic Equivalence Validation
# ==============================================================================
# Integration: docs/integration-report-golden-trace.md
# Epic: GOLDEN-001 (Sprints 40-44)
#
# Validates that Python→Rust transpilations preserve semantic equivalence
# using syscall-level traces with Lamport clock causal ordering.

[semantic_equivalence]
enabled = true
python_trace_dir = "golden_traces/python"
rust_trace_dir = "golden_traces/rust"
baseline_dir = "golden_traces/baseline"
min_confidence = 0.90  # 90% confidence required for PASS

# Validation checks
check_write_patterns = true          # Output correctness (most critical)
check_file_operations = true         # I/O behavior equivalence
check_output_correctness = true      # Exact output matching
check_memory_allocations = false     # Expect Python/Rust to differ

# Performance expectations (Rust vs Python)
expected_speedup_min = 3.0           # Rust ≥3× faster (conservative)
expected_speedup_max = 20.0          # Sanity check (>20× suspicious)
expected_memory_reduction_min = 2.0  # Rust uses ≤50% of Python memory

# Lamport clock configuration
[lamport_clock]
enabled = true
propagate_across_fork = true
propagate_across_exec = true
env_var = "RENACER_LAMPORT_CLOCK"

# Trace compression (Sprint 41)
[compression]
enabled = true
algorithm = "rle"  # Run-length encoding
min_file_size_kb = 100  # Only compress traces >100KB

# OpenTelemetry export (optional - for Jaeger/Grafana integration)
[otlp]
enabled = false  # Enable when observability stack available
endpoint = "http://localhost:4317"
service_name = "reprorusted-python-cli"

# CI/CD integration
[ci]
fail_fast = true  # Stop on first assertion failure (Andon principle)
export_format = "json"
export_path = "target/renacer-reports"
compare_with_baseline = true
